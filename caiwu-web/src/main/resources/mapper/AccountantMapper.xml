<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.zhimeng.caiwuweb.dao.AccountantMapper">
  <resultMap id="BaseResultMap" type="com.zhimeng.caiwuweb.entity.Accountant">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <result column="select_id" jdbcType="VARCHAR" property="selectId" />
    <result column="cus_name" jdbcType="VARCHAR" property="cusName" />
    <result column="food_money" jdbcType="DOUBLE" property="foodMoney" />
    <result column="vehicle_money" jdbcType="DOUBLE" property="vehicleMoney" />
    <result column="count_money" jdbcType="DOUBLE" property="countMoney" />
    <result column="travel_start_time" jdbcType="TIMESTAMP" property="travelStartTime" />
    <result column="travel_end_time" jdbcType="TIMESTAMP" property="travelEndTime" />
    <result column="remark" jdbcType="VARCHAR" property="remark" />
    <result column="travel_type" jdbcType="INTEGER" property="travelType" />
    <result column="vehicle_type" jdbcType="INTEGER" property="vehicleType" />
    <result column="type" jdbcType="INTEGER" property="type" />
    <result column="record_time" jdbcType="INTEGER" property="recordTime" />
    <result column="status" jdbcType="INTEGER" property="status" />
    <result column="table_type" jdbcType="INTEGER" property="tableType" />
    <result column="travel_time" jdbcType="INTEGER" property="travelTime" />
    <result column="area_id" jdbcType="INTEGER" property="areaId" />
    <result column="travel_time_list" jdbcType="VARCHAR" property="travelTimeList" />
    <result column="travel_region" jdbcType="VARCHAR" property="travelRegion" />
    <result column="travel_area" jdbcType="VARCHAR" property="travelArea" />
    <result column="batch_number" jdbcType="VARCHAR" property="batchNumber" />
    <result column="id" jdbcType="INTEGER" property="id" />
    <result column="repetition" jdbcType="INTEGER" property="repetition" />
  </resultMap>

  <sql id="Base_Column_List">
  select_id, cus_name, food_money,
      vehicle_money, count_money, travel_start_time,
      travel_end_time, remark, travel_type,
      vehicle_type, type, record_time,
      status, table_type,travel_time_list,travel_region,travel_area,batch_number,id,repetition
  </sql>

  <select id="selectByCoding" parameterType="com.zhimeng.caiwuweb.entity.Accountant" resultMap="BaseResultMap">
    select
    <include refid="Base_Column_List" />
    from accountant
    <where>
      <if test="selectId != null">
        select_id= #{selectId,jdbcType=VARCHAR}
      </if>
      <if test="status != null">
        AND  status= #{status,jdbcType=INTEGER}
      </if>
      <if test="repetition != null">
        AND repetition= #{repetition,jdbcType=INTEGER}
      </if>
    </where>
  </select>

  <select id="selectById" parameterType="java.lang.Integer" resultMap="BaseResultMap">
    select
    <include refid="Base_Column_List" />
    from accountant
    where id = #{selectId,jdbcType=INTEGER}
  </select>


  <select id="selectByName" parameterType="com.zhimeng.caiwuweb.entity.Accountant" resultMap="BaseResultMap">
    select
    <include refid="Base_Column_List" />
    from accountant
    where cus_name= #{cusName,jdbcType=VARCHAR} and status= #{status,jdbcType=INTEGER}
    <if test="travelRegion != null">
      and travel_region = #{travelRegion,jdbcType=VARCHAR}
    </if>
  </select>

  <select id="selectName" parameterType="java.lang.String" resultMap="BaseResultMap">
    select
    <include refid="Base_Column_List" />
    from accountant
    where cus_name= #{cusName,jdbcType=VARCHAR}
    <if test="travelRegion != null">
      and travel_region = #{travelRegion,jdbcType=VARCHAR}
    </if>
  </select>

  <select id="selectByBatchNumber" parameterType="java.lang.String" resultMap="BaseResultMap">
    select
    <include refid="Base_Column_List" />
    from accountant
    where batch_number= #{batchNumber,jdbcType=VARCHAR}
  </select>

  <select id="selectAccJoinTravel" parameterType="com.zhimeng.caiwuweb.entity.Accountant" resultMap="BaseResultMap">
     select
    select_id, cus_name, count_money, remark, travel_type,
      vehicle_type,travel_area,travel_time_list
    from accountant
     <where>
       <if test="selectId != null">
         select_id= #{selectId,jdbcType=VARCHAR}
       </if>
       <if test="status != null">
       AND  status= #{status,jdbcType=INTEGER}
       </if>
       <if test="repetition != null">
        AND repetition= #{repetition,jdbcType=INTEGER}
       </if>
       <if test="travelRegion != null">
        and  travel_region = #{travelRegion,jdbcType=VARCHAR}
       </if>
     </where>
  </select>

  <select id="selectAccJoinTravelById" parameterType="com.zhimeng.caiwuweb.entity.Accountant" resultMap="BaseResultMap">
     select
    select_id, cus_name, count_money, remark, travel_type,
      vehicle_type,travel_area,travel_time_list
    from accountant
    <where>
      <if test="id != null">
        id= #{id,jdbcType=INTEGER}
      </if>
      <if test="status != null">
        AND  status= #{status,jdbcType=INTEGER}
      </if>
      <if test="repetition != null">
        AND repetition= #{repetition,jdbcType=INTEGER}
      </if>
      <if test="travelRegion != null">
        and travel_region = #{travelRegion,jdbcType=VARCHAR}
      </if>
    </where>
  </select>


  <select id="selectAll" parameterType="com.zhimeng.caiwuweb.entity.Accountant" resultMap="BaseResultMap">
    select
    <include refid="Base_Column_List" />
    from accountant
    <where>
      <if test="travelType != null">
         travel_type =#{travelType,jdbcType=INTEGER}
      </if>
      <if test="vehicleType != null">
        AND vehicle_type =#{vehicleType,jdbcType=INTEGER}
      </if>
      <if test="cusName != null">
        AND cus_name= #{cusName,jdbcType=VARCHAR}
      </if>
      <if test="status != null">
        AND status= #{status,jdbcType=INTEGER}
      </if>
      <if test="travelStartTime != null">
        AND travel_start_time >= #{travelStartTime,jdbcType=TIMESTAMP} and travel_end_time &lt;=#{travelEndTime,jdbcType=TIMESTAMP}
      </if>
      <if test="travelRegion != null">
        <!-- 这里注释掉,查询本级及下级单位-->
        <!--AND travel_region=#{travelRegion,jdbcType=VARCHAR} -->
      </if>
      <if test="repetition != null">
        <!-- 注释掉查询不重复的，将所有重复的没重复的全部展示出来-->
        AND repetition=#{repetition,jdbcType=INTEGER}
      </if>

      <!-- 判断是不是超级管理员,超级管理员需要查询本级及下级 -->
      <choose>
        <when test="cusAuthority != null and travelRegion != null">
          and travel_region in (
          SELECT
          case
          when t3.cityname is not null then t3.cityname
          when t2.cityname is not null then t2.cityname
          when t1.cityname is not null then t1.cityname
          end as cityname
          FROM (select id,cityname,pid from city where type = 5) t1
          LEFT JOIN (select id,cityname,pid from city where type = 5) t2 ON t1.id = t2.pid
          LEFT JOIN (select id,cityname,pid from city where type = 5) t3 ON t2.id = t3.pid
          WHERE t1.cityname = #{travelRegion,jdbcType=VARCHAR}
          )
        </when>
        <when test="travelRegion != null">
          AND  travel_region = #{travelRegion,jdbcType=VARCHAR}
        </when>
        <otherwise>
          and 1 = 1
        </otherwise>
      </choose>

    <!--  <if test="travelRegion != null">
        and ( travel_region=#{travelRegion,jdbcType=VARCHAR}
            or travel_region = #{travelRegion,jdbcType=VARCHAR})
      </if>-->

      <!-- 添加单位过滤 2020.06.17-->
      <if test="unit != null">
        <!-- 查询本级及下级单位-->
        AND  travel_region in
         (
        SELECT
        case
        when t3.cityname is not null then t3.cityname
        when t2.cityname is not null then t2.cityname
        when t1.cityname is not null then t1.cityname
        end as cityname
        FROM (select id,cityname,pid from city where type = 5) t1
        LEFT JOIN (select id,cityname,pid from city where type = 5) t2 ON t1.id = t2.pid
        LEFT JOIN (select id,cityname,pid from city where type = 5) t3 ON t2.id = t3.pid
        WHERE t1.id = #{unit,jdbcType=VARCHAR}
        )
      </if>
    </where>
    <if test="type != null">
      order by cus_name,repetition,record_time asc
    </if>
     <if test="type == null">
    order by cus_name,repetition,record_time desc
  </if>
  </select>

  <insert id="insert" parameterType="com.zhimeng.caiwuweb.entity.Accountant">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    insert into accountant (select_id, cus_name, food_money,
    vehicle_money, count_money, travel_start_time,
    travel_end_time, remark, travel_type,
    vehicle_type, type, record_time,
    status, table_type,travel_time_list,travel_region,travel_area,batch_number)
    values (#{selectId,jdbcType=VARCHAR}, #{cusName,jdbcType=VARCHAR}, #{foodMoney,jdbcType=DOUBLE},
    #{vehicleMoney,jdbcType=DOUBLE}, #{countMoney,jdbcType=DOUBLE}, #{travelStartTime,jdbcType=TIMESTAMP},
    #{travelEndTime,jdbcType=TIMESTAMP}, #{remark,jdbcType=VARCHAR}, #{travelType,jdbcType=INTEGER},
    #{vehicleType,jdbcType=INTEGER}, #{type,jdbcType=INTEGER}, #{recordTime,jdbcType=TIMESTAMP},
    #{status,jdbcType=INTEGER}, #{tableType,jdbcType=INTEGER},#{travelTimeList,jdbcType=VARCHAR},#{travelRegion,jdbcType=VARCHAR}
    ,#{travelArea,jdbcType=VARCHAR},#{batchNumber,jdbcType=VARCHAR})
  </insert>
  <insert id="insertSelective" parameterType="com.zhimeng.caiwuweb.entity.Accountant" keyProperty="id" useGeneratedKeys="true">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    insert into accountant
    <trim prefix="(" suffix=")" suffixOverrides=",">
      <if test="selectId != null">
        select_id,
      </if>
      <if test="id != null">
        id,
      </if>
      <if test="cusName != null">
        cus_name,
      </if>
      <if test="foodMoney != null">
        food_money,
      </if>
      <if test="vehicleMoney != null">
        vehicle_money,
      </if>
      <if test="countMoney != null">
        count_money,
      </if>
      <if test="travelStartTime != null">
        travel_start_time,
      </if>
      <if test="travelEndTime != null">
        travel_end_time,
      </if>
      <if test="remark != null">
        remark,
      </if>
      <if test="travelType != null">
        travel_type,
      </if>
      <if test="vehicleType != null">
        vehicle_type,
      </if>
      <if test="type != null">
        type,
      </if>
      <if test="recordTime != null">
        record_time,
      </if>
      <if test="status != null">
        status,
      </if>
      <if test="tableType != null">
        table_type,
      </if>

      <if test="travelTimeList != null">
        travel_time_list,
      </if>
      <if test="travelRegion != null">
        travel_region,
      </if>
      <if test="travelArea != null">
        travel_area,
      </if>
      <if test="batchNumber != null">
        batch_number,
      </if>
      <if test="repetition != null">
        repetition,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides=",">
      <if test="selectId != null">
        #{selectId,jdbcType=VARCHAR},
      </if>
      <if test="id != null">
        #{id,jdbcType=INTEGER},
      </if>
      <if test="cusName != null">
        #{cusName,jdbcType=VARCHAR},
      </if>
      <if test="foodMoney != null">
        #{foodMoney,jdbcType=DOUBLE},
      </if>
      <if test="vehicleMoney != null">
        #{vehicleMoney,jdbcType=DOUBLE},
      </if>
      <if test="countMoney != null">
        #{countMoney,jdbcType=DOUBLE},
      </if>
      <if test="travelStartTime != null">
        #{travelStartTime,jdbcType=TIMESTAMP},
      </if>
      <if test="travelEndTime != null">
        #{travelEndTime,jdbcType=TIMESTAMP},
      </if>
      <if test="remark != null">
        #{remark,jdbcType=VARCHAR},
      </if>
      <if test="travelType != null">
        #{travelType,jdbcType=INTEGER},
      </if>
      <if test="vehicleType != null">
        #{vehicleType,jdbcType=INTEGER},
      </if>
      <if test="type != null">
        #{type,jdbcType=INTEGER},
      </if>
      <if test="recordTime != null">
        #{recordTime,jdbcType=TIMESTAMP},
      </if>
      <if test="status != null">
        #{status,jdbcType=INTEGER},
      </if>
      <if test="tableType != null">
        #{tableType,jdbcType=INTEGER},
      </if>
      <if test="travelTimeList != null">
        #{travelTimeList,jdbcType=INTEGER},
      </if>
      <if test="travelRegion != null">
        #{travelRegion,jdbcType=VARCHAR},
      </if>
      <if test="travelArea != null">
        #{travelArea,jdbcType=VARCHAR},
      </if>
      <if test="batchNumber != null">
        #{batchNumber,jdbcType=VARCHAR},
      </if>
      <if test="repetition != null">
        #{repetition,jdbcType=INTEGER},
      </if>
    </trim>
  </insert>

  <update id="updateByPrimaryKeySelective" parameterType="com.zhimeng.caiwuweb.entity.Accountant">
    update accountant
    <set>
      <if test="cusName != null">
        cus_name=#{cusName,jdbcType=VARCHAR},
      </if>
      <if test="foodMoney != null">
        food_money=#{foodMoney,jdbcType=DOUBLE},
      </if>
      <if test="vehicleMoney != null">
        vehicle_money=#{vehicleMoney,jdbcType=DOUBLE},
      </if>
      <if test="countMoney != null">
        count_money=#{countMoney,jdbcType=DOUBLE},
      </if>
      <if test="travelStartTime != null">
        travel_start_time=#{travelStartTime,jdbcType=TIMESTAMP},
      </if>
      <if test="travelEndTime != null">
        travel_end_time=#{travelEndTime,jdbcType=TIMESTAMP},
      </if>
      <if test="remark != null">
        remark=#{remark,jdbcType=VARCHAR},
      </if>
      <if test="travelType != null">
        travel_type=#{travelType,jdbcType=INTEGER},
      </if>
      <if test="vehicleType != null">
        vehicle_type=#{vehicleType,jdbcType=INTEGER},
      </if>
      <if test="type != null">
        type=#{type,jdbcType=INTEGER},
      </if>
      <if test="recordTime != null">
        record_time=#{recordTime,jdbcType=TIMESTAMP},
      </if>
      <if test="status != null">
        status=#{status,jdbcType=INTEGER},
      </if>
      <if test="tableType != null">
        table_type= #{tableType,jdbcType=INTEGER},
      </if>
      <if test="travelTimeList != null">
        travel_time_list= #{travelTimeList,jdbcType=INTEGER},
      </if>
      <if test="travelRegion != null">
        travel_region= #{travelRegion,jdbcType=VARCHAR},
      </if>
      <if test="travelArea != null">
        travel_area= #{travelArea,jdbcType=VARCHAR},
      </if>
      <if test="batchNumber != null">
        batch_number= #{batchNumber,jdbcType=VARCHAR},
      </if>
      <if test="repetition != null">
        repetition= #{repetition,jdbcType=INTEGER},
      </if>
    </set>
    where id =  #{id,jdbcType=INTEGER}
  </update>

  <update id="updateBySelectIdSelective" parameterType="com.zhimeng.caiwuweb.entity.Accountant">
    update accountant
    <set>
      <if test="cusName != null">
        cus_name=#{cusName,jdbcType=VARCHAR},
      </if>
      <if test="foodMoney != null">
        food_money=#{foodMoney,jdbcType=DOUBLE},
      </if>
      <if test="vehicleMoney != null">
        vehicle_money=#{vehicleMoney,jdbcType=DOUBLE},
      </if>
      <if test="countMoney != null">
        count_money=#{countMoney,jdbcType=DOUBLE},
      </if>
      <if test="travelStartTime != null">
        travel_start_time=#{travelStartTime,jdbcType=TIMESTAMP},
      </if>
      <if test="travelEndTime != null">
        travel_end_time=#{travelEndTime,jdbcType=TIMESTAMP},
      </if>
      <if test="remark != null">
        remark=#{remark,jdbcType=VARCHAR},
      </if>
      <if test="travelType != null">
        travel_type=#{travelType,jdbcType=INTEGER},
      </if>
      <if test="vehicleType != null">
        vehicle_type=#{vehicleType,jdbcType=INTEGER},
      </if>
      <if test="type != null">
        type=#{type,jdbcType=INTEGER},
      </if>
      <if test="recordTime != null">
        record_time=#{recordTime,jdbcType=TIMESTAMP},
      </if>
      <if test="status != null">
        status=#{status,jdbcType=INTEGER},
      </if>
      <if test="tableType != null">
        table_type= #{tableType,jdbcType=INTEGER},
      </if>
      <if test="travelTimeList != null">
        travel_time_list= #{travelTimeList,jdbcType=INTEGER},
      </if>
      <if test="travelRegion != null">
        travel_region= #{travelRegion,jdbcType=VARCHAR},
      </if>
      <if test="travelArea != null">
        travel_area= #{travelArea,jdbcType=VARCHAR},
      </if>
      <if test="batchNumber != null">
        batch_number= #{batchNumber,jdbcType=VARCHAR},
      </if>
      <if test="repetition != null">
        repetition= #{repetition,jdbcType=INTEGER},
      </if>
    </set>
    where select_id =  #{selectId,jdbcType=VARCHAR} and cus_name=#{cusName,jdbcType=VARCHAR}
  </update>

</mapper>